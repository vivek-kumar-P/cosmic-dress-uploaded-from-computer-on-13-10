<!-- b77c1c8e-1551-46d5-83ca-9109406283f0 e24cf380-4ac3-42ec-abe6-0d65fef50c80 -->
# 3D T‑Shirt Customizer: Integration Plan

## Scope

Implement a 3D T‑Shirt customizer inside the existing `app/customize/page.tsx` route with:

- Color changes
- Logo/full-texture decals (file upload and URL)
- Chat-bot interaction for real-time updates (rule-based parser with optional OpenAI integration)
- Screenshot export of the canvas

## Key Dependencies (add to root `package.json`)

- `@react-three/fiber`, `@react-three/drei`, `valtio`, `react-color`, `maath`
- (Optional) `openai` only if AI bot is enabled via env

## Assets (copy from source)

- Copy `shirt_baked.glb` into `public/models/shirt_baked.glb`
- Copy default decal images (e.g., `threejs.png`) into `public/textures/`

## New Files

- `components/customizer/CustomizationStore.ts` — Valtio store mirroring source state (intro, color, flags, decals)
- `components/customizer/TShirtModel.tsx` — Ported `Shirt` component to TSX using `useGLTF` + `Decal`
- `components/customizer/CanvasStage.tsx` — R3F `<Canvas>` scene with `Environment`, `Center`, and camera rig
- `components/customizer/controls/ColorPicker.tsx` — Color picker (react-color)
- `components/customizer/controls/FilePicker.tsx` — Upload/logo URL input → read as dataURL and set decals
- `components/customizer/controls/Tabs.tsx` — Editor and filter tabs UI
- `components/customizer/ChatBot.tsx` — Chat UI; rule-based parsing (e.g., "color red", "add logo <url>") that updates Valtio state; optional OpenAI when `OPENAI_API_KEY` present
- `components/customizer/ScreenshotButton.tsx` — Export canvas via `toDataURL` (with `preserveDrawingBuffer`)
- `components/customizer/Download.ts` — Helpers for download logic

## Edits

- `app/customize/page.tsx` — Replace body with the new customizer layout: left controls (tabs, color/file picker, chatbot), right R3F canvas, top-right screenshot button.
- `components/navbar.tsx` — Ensure Customize nav points to `/customize` (no change if already present)

## Behavior Details

- Color change: damp material color via `maath/easing` for smoothness
- Logos: Place `Decal` for small logo; full-shirt overlay for all-over print; toggled by filter tabs
- Chat-bot:
- Rule-based commands: `color <name|#hex>`, `logo <url>`, `full <url>`, `toggle logo|full`, `reset`, `screenshot`
- If `OPENAI_API_KEY` is set, forward message to OpenAI with a short system prompt to output normalized commands that we execute
- Screenshot: Button and chat command create PNG and trigger download

## Minimal TypeScript Contracts

- Exported Valtio snapshot typing for `color`, `isLogoTexture`, `isFullTexture`, `logoDecal`, `fullDecal`
- `TShirtModel` props kept minimal; GLB path constant

## Integration Notes

- Keep the new customizer isolated under `components/customizer/*` to avoid regressions
- Use R3F only for this feature; existing Three.js code remains untouched
- Guard OpenAI usage behind env; fallback to local parser

## Testing

- Manual QA on `/customize`:
- Change color via picker and via chat
- Upload logo; verify small and full decals
- Toggle tabs and verify state
- Screenshot file downloads and matches canvas view

### To-dos

- [ ] Add R3F, drei, valtio, react-color, maath deps to root package.json
- [ ] Copy shirt_baked.glb and default decals to public paths
- [ ] Create Valtio CustomizationStore with initial state
- [ ] Port Shirt model to TSX as TShirtModel using useGLTF + Decal
- [ ] Create CanvasStage scene with Environment and camera rig
- [ ] Add ColorPicker, FilePicker, Tabs components for editor/filter
- [ ] Implement ChatBot with rule parser and optional OpenAI
- [ ] Add ScreenshotButton and download helper
- [ ] Integrate new customizer into app/customize/page.tsx layout
- [ ] QA all flows: color, logos, chat commands, screenshot